<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>QTrk: QI Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">QTrk
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="class_q_i-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">QI Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Class to specifically perform quadrant interpolation calculations on the GPU.  
 <a href="class_q_i.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="_q_i_8h_source.html">QI.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_q_i_1_1_device_instance.html">DeviceInstance</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Contains all <a class="el" href="class_q_i.html" title="Class to specifically perform quadrant interpolation calculations on the GPU. ">QI</a> memory space that is allocated per device (shared between streams).  <a href="struct_q_i_1_1_device_instance.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_q_i_1_1_stream_instance.html">StreamInstance</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Contains all <a class="el" href="class_q_i.html" title="Class to specifically perform quadrant interpolation calculations on the GPU. ">QI</a> memory space that is allocated per stream.  <a href="struct_q_i_1_1_stream_instance.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a084274d952e1430627110818f398a3d4"><td class="memTemplParams" colspan="2">template&lt;typename TImageSampler &gt; </td></tr>
<tr class="memitem:a084274d952e1430627110818f398a3d4"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="class_q_i.html#a084274d952e1430627110818f398a3d4">Execute</a> (<a class="el" href="struct_base_kernel_params.html">BaseKernelParams</a> &amp;p, const <a class="el" href="struct_q_trk_computed_config.html">QTrkComputedConfig</a> &amp;cfg, <a class="el" href="struct_q_i_1_1_stream_instance.html">StreamInstance</a> *s, <a class="el" href="struct_q_i_1_1_device_instance.html">DeviceInstance</a> *d, <a class="el" href="classdevice__vec.html">device_vec</a>&lt; float3 &gt; *initial, <a class="el" href="classdevice__vec.html">device_vec</a>&lt; float3 &gt; *output)</td></tr>
<tr class="memdesc:a084274d952e1430627110818f398a3d4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Execute a batch of <a class="el" href="class_q_i.html" title="Class to specifically perform quadrant interpolation calculations on the GPU. ">QI</a> calculations. Runs <a class="el" href="class_q_i.html#a7fef057a722e3c85152f947c7a7dd42a">Iterate</a> the correct number of times and recalculates the number of radial spokes for every iteration, based on <a class="el" href="struct_q_trk_settings.html#aceebf67ba9ecc215d49c6b2739afae3d" title="Factor to reduce angular steps on lower iterations. Default 1.0 (no effect). ">QTrkComputedConfig::qi_angstep_factor</a>.  <a href="#a084274d952e1430627110818f398a3d4">More...</a><br /></td></tr>
<tr class="separator:a084274d952e1430627110818f398a3d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a20a5d23a269c8c5cc1dcce1f5d931e20"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_q_i.html#a20a5d23a269c8c5cc1dcce1f5d931e20">InitDevice</a> (<a class="el" href="struct_q_i_1_1_device_instance.html">DeviceInstance</a> *d, <a class="el" href="struct_q_trk_computed_config.html">QTrkComputedConfig</a> &amp;cc)</td></tr>
<tr class="memdesc:a20a5d23a269c8c5cc1dcce1f5d931e20"><td class="mdescLeft">&#160;</td><td class="mdescRight">Ready a device for QI calculations.  <a href="#a20a5d23a269c8c5cc1dcce1f5d931e20">More...</a><br /></td></tr>
<tr class="separator:a20a5d23a269c8c5cc1dcce1f5d931e20"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae560c53ae31c70ca9a1d6a0a745c75ee"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_q_i.html#ae560c53ae31c70ca9a1d6a0a745c75ee">InitStream</a> (<a class="el" href="struct_q_i_1_1_stream_instance.html">StreamInstance</a> *s, <a class="el" href="struct_q_trk_computed_config.html">QTrkComputedConfig</a> &amp;cc, cudaStream_t stream, int <a class="el" href="class_q_i.html#aa7bd10a94c9128943ff9f1775614f704">batchSize</a>)</td></tr>
<tr class="memdesc:ae560c53ae31c70ca9a1d6a0a745c75ee"><td class="mdescLeft">&#160;</td><td class="mdescRight">Ready a stream for QI calculations.  <a href="#ae560c53ae31c70ca9a1d6a0a745c75ee">More...</a><br /></td></tr>
<tr class="separator:ae560c53ae31c70ca9a1d6a0a745c75ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4d2c72e4f110d37299c01da8480671f4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_q_i.html#a4d2c72e4f110d37299c01da8480671f4">Init</a> (<a class="el" href="struct_q_trk_computed_config.html">QTrkComputedConfig</a> &amp;cfg, int <a class="el" href="class_q_i.html#aa7bd10a94c9128943ff9f1775614f704">batchSize</a>)</td></tr>
<tr class="memdesc:a4d2c72e4f110d37299c01da8480671f4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize this QI instance.  <a href="#a4d2c72e4f110d37299c01da8480671f4">More...</a><br /></td></tr>
<tr class="separator:a4d2c72e4f110d37299c01da8480671f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:a7fef057a722e3c85152f947c7a7dd42a"><td class="memTemplParams" colspan="2">template&lt;typename TImageSampler &gt; </td></tr>
<tr class="memitem:a7fef057a722e3c85152f947c7a7dd42a"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="class_q_i.html#a7fef057a722e3c85152f947c7a7dd42a">Iterate</a> (<a class="el" href="struct_base_kernel_params.html">BaseKernelParams</a> &amp;p, <a class="el" href="classdevice__vec.html">device_vec</a>&lt; float3 &gt; *initial, <a class="el" href="classdevice__vec.html">device_vec</a>&lt; float3 &gt; *output, <a class="el" href="struct_q_i_1_1_stream_instance.html">StreamInstance</a> *s, <a class="el" href="struct_q_i_1_1_device_instance.html">DeviceInstance</a> *d, int angularSteps)</td></tr>
<tr class="memdesc:a7fef057a722e3c85152f947c7a7dd42a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Perform one QI iteration.  <a href="#a7fef057a722e3c85152f947c7a7dd42a">More...</a><br /></td></tr>
<tr class="separator:a7fef057a722e3c85152f947c7a7dd42a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aae8ddb96f755ee2cc38d9fb36e742dde"><td class="memItemLeft" align="right" valign="top">dim3&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_q_i.html#aae8ddb96f755ee2cc38d9fb36e742dde">blocks</a> (int njobs)</td></tr>
<tr class="memdesc:aae8ddb96f755ee2cc38d9fb36e742dde"><td class="mdescLeft">&#160;</td><td class="mdescRight">Same function as <a class="el" href="class_queued_c_u_d_a_tracker.html#a935e85ca846ef768ffeca1ff4a23ab21">QueuedCUDATracker::blocks</a>.  <a href="#aae8ddb96f755ee2cc38d9fb36e742dde">More...</a><br /></td></tr>
<tr class="separator:aae8ddb96f755ee2cc38d9fb36e742dde"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aef6a690a8934bcc7ced5332518b04660"><td class="memItemLeft" align="right" valign="top">dim3&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_q_i.html#aef6a690a8934bcc7ced5332518b04660">threads</a> ()</td></tr>
<tr class="memdesc:aef6a690a8934bcc7ced5332518b04660"><td class="mdescLeft">&#160;</td><td class="mdescRight">Same function as <a class="el" href="class_queued_c_u_d_a_tracker.html#ae88c5554dba8227967f4a600ff7fab84">QueuedCUDATracker::threads</a>.  <a href="#aef6a690a8934bcc7ced5332518b04660">More...</a><br /></td></tr>
<tr class="separator:aef6a690a8934bcc7ced5332518b04660"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:af69f420666212bcf5f10a5cf03cd161a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="struct_q_i_params.html">QIParams</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_q_i.html#af69f420666212bcf5f10a5cf03cd161a">params</a></td></tr>
<tr class="memdesc:af69f420666212bcf5f10a5cf03cd161a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Structure with settings relevant to quadrant interpolation.  <a href="#af69f420666212bcf5f10a5cf03cd161a">More...</a><br /></td></tr>
<tr class="separator:af69f420666212bcf5f10a5cf03cd161a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9959b6d60486da504fca5c3c86fb2fdd"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_q_i.html#a9959b6d60486da504fca5c3c86fb2fdd">qi_FFT_length</a></td></tr>
<tr class="memdesc:a9959b6d60486da504fca5c3c86fb2fdd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parameter for length required for arrays going into FFT. 2 * radial steps.  <a href="#a9959b6d60486da504fca5c3c86fb2fdd">More...</a><br /></td></tr>
<tr class="separator:a9959b6d60486da504fca5c3c86fb2fdd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa7bd10a94c9128943ff9f1775614f704"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_q_i.html#aa7bd10a94c9128943ff9f1775614f704">batchSize</a></td></tr>
<tr class="memdesc:aa7bd10a94c9128943ff9f1775614f704"><td class="mdescLeft">&#160;</td><td class="mdescRight">See <a class="el" href="class_queued_c_u_d_a_tracker.html#a19a027c0cc319821c25de1cb23e14a17">QueuedCUDATracker::batchSize</a>. Local copy.  <a href="#aa7bd10a94c9128943ff9f1775614f704">More...</a><br /></td></tr>
<tr class="separator:aa7bd10a94c9128943ff9f1775614f704"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afd1c6359668f2de142a18caf2a0e76e0"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_q_i.html#afd1c6359668f2de142a18caf2a0e76e0">numThreads</a></td></tr>
<tr class="memdesc:afd1c6359668f2de142a18caf2a0e76e0"><td class="mdescLeft">&#160;</td><td class="mdescRight">See <a class="el" href="class_queued_c_u_d_a_tracker.html#a1bbaf466f197bd745411786578b743bc">QueuedCUDATracker::numThreads</a>.  <a href="#afd1c6359668f2de142a18caf2a0e76e0">More...</a><br /></td></tr>
<tr class="separator:afd1c6359668f2de142a18caf2a0e76e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Class to specifically perform quadrant interpolation calculations on the GPU. </p>
<p>Maintains all memory and functions related to QI to keep <a class="el" href="class_queued_c_u_d_a_tracker.html" title="CUDA implementation of the QueuedTracker interface. ">QueuedCUDATracker</a> more clean. </p>

<p>Definition at line <a class="el" href="_q_i_8h_source.html#l00020">20</a> of file <a class="el" href="_q_i_8h_source.html">QI.h</a>.</p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a id="aae8ddb96f755ee2cc38d9fb36e742dde"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aae8ddb96f755ee2cc38d9fb36e742dde">&sect;&nbsp;</a></span>blocks()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">dim3 QI::blocks </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>njobs</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Same function as <a class="el" href="class_queued_c_u_d_a_tracker.html#a935e85ca846ef768ffeca1ff4a23ab21">QueuedCUDATracker::blocks</a>. </p>

<p>Definition at line <a class="el" href="_q_i_8h_source.html#l00153">153</a> of file <a class="el" href="_q_i_8h_source.html">QI.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;{ <span class="keywordflow">return</span> dim3((njobs+<a class="code" href="class_q_i.html#afd1c6359668f2de142a18caf2a0e76e0">numThreads</a>-1)/<a class="code" href="class_q_i.html#afd1c6359668f2de142a18caf2a0e76e0">numThreads</a>); }</div><div class="ttc" id="class_q_i_html_afd1c6359668f2de142a18caf2a0e76e0"><div class="ttname"><a href="class_q_i.html#afd1c6359668f2de142a18caf2a0e76e0">QI::numThreads</a></div><div class="ttdeci">int numThreads</div><div class="ttdoc">See QueuedCUDATracker::numThreads. </div><div class="ttdef"><b>Definition:</b> <a href="_q_i_8h_source.html#l00150">QI.h:150</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a084274d952e1430627110818f398a3d4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a084274d952e1430627110818f398a3d4">&sect;&nbsp;</a></span>Execute()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename TImageSampler &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void QI::Execute </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_base_kernel_params.html">BaseKernelParams</a> &amp;&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="struct_q_trk_computed_config.html">QTrkComputedConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>cfg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_q_i_1_1_stream_instance.html">QI::StreamInstance</a> *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_q_i_1_1_device_instance.html">QI::DeviceInstance</a> *&#160;</td>
          <td class="paramname"><em>d</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classdevice__vec.html">device_vec</a>&lt; float3 &gt; *&#160;</td>
          <td class="paramname"><em>initial</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classdevice__vec.html">device_vec</a>&lt; float3 &gt; *&#160;</td>
          <td class="paramname"><em>output</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Execute a batch of <a class="el" href="class_q_i.html" title="Class to specifically perform quadrant interpolation calculations on the GPU. ">QI</a> calculations. Runs <a class="el" href="class_q_i.html#a7fef057a722e3c85152f947c7a7dd42a">Iterate</a> the correct number of times and recalculates the number of radial spokes for every iteration, based on <a class="el" href="struct_q_trk_settings.html#aceebf67ba9ecc215d49c6b2739afae3d" title="Factor to reduce angular steps on lower iterations. Default 1.0 (no effect). ">QTrkComputedConfig::qi_angstep_factor</a>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">p</td><td>Reference to <a class="el" href="struct_base_kernel_params.html">BaseKernelParams</a> with parameters for this call. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cfg</td><td>Reference to the settings to use. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">s</td><td>The <a class="el" href="struct_q_i_1_1_stream_instance.html" title="Contains all QI memory space that is allocated per stream. ">QI::StreamInstance</a> to use. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">d</td><td>The <a class="el" href="struct_q_i_1_1_device_instance.html" title="Contains all QI memory space that is allocated per device (shared between streams). ">QI::DeviceInstance</a> to use. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">initial</td><td>Vector with the initial positions from which to start the radial samplings on the first iteration. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">output</td><td>Vector that will be filled with the final results. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_q_i__impl_8h_source.html#l00268">268</a> of file <a class="el" href="_q_i__impl_8h_source.html">QI_impl.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;{</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="keywordtype">float</span> angsteps = cfg.<a class="code" href="struct_q_trk_computed_config.html#a1ba87257b24e5b7e427aa92dd4114792">qi_angstepspq</a> / powf(cfg.<a class="code" href="struct_q_trk_settings.html#aceebf67ba9ecc215d49c6b2739afae3d">qi_angstep_factor</a>, cfg.<a class="code" href="struct_q_trk_settings.html#a12105babb328a9a7ec90f0eab074fabb">qi_iterations</a>);</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> a=0;a&lt;cfg.<a class="code" href="struct_q_trk_settings.html#a12105babb328a9a7ec90f0eab074fabb">qi_iterations</a>;a++) {</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        <a class="code" href="classdevice__vec.html">device_vec&lt;float3&gt;</a>* dst = a==0 ? initial : output;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        Iterate&lt; TImageSampler &gt; (p, dst, output, s, d, std::max(<a class="code" href="_queued_tracker_8h.html#a1625167c310599739f4d73170413e64a">MIN_RADPROFILE_SMP_COUNT</a>, (<span class="keywordtype">int</span>)angsteps) );</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        angsteps *= cfg.<a class="code" href="struct_q_trk_settings.html#aceebf67ba9ecc215d49c6b2739afae3d">qi_angstep_factor</a>;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    }</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;}</div><div class="ttc" id="classdevice__vec_html"><div class="ttname"><a href="classdevice__vec.html">device_vec&lt; float3 &gt;</a></div></div>
<div class="ttc" id="_queued_tracker_8h_html_a1625167c310599739f4d73170413e64a"><div class="ttname"><a href="_queued_tracker_8h.html#a1625167c310599739f4d73170413e64a">MIN_RADPROFILE_SMP_COUNT</a></div><div class="ttdeci">#define MIN_RADPROFILE_SMP_COUNT</div><div class="ttdoc">Minimum number of samples for a profile radial bin. Below this the image mean will be used...</div><div class="ttdef"><b>Definition:</b> <a href="_queued_tracker_8h_source.html#l00074">QueuedTracker.h:74</a></div></div>
<div class="ttc" id="struct_q_trk_computed_config_html_a1ba87257b24e5b7e427aa92dd4114792"><div class="ttname"><a href="struct_q_trk_computed_config.html#a1ba87257b24e5b7e427aa92dd4114792">QTrkComputedConfig::qi_angstepspq</a></div><div class="ttdeci">int qi_angstepspq</div><div class="ttdoc">Number of angular steps to sample on per quadrant. </div><div class="ttdef"><b>Definition:</b> <a href="qtrk__c__api_8h_source.html#l00203">qtrk_c_api.h:203</a></div></div>
<div class="ttc" id="struct_q_trk_settings_html_a12105babb328a9a7ec90f0eab074fabb"><div class="ttname"><a href="struct_q_trk_settings.html#a12105babb328a9a7ec90f0eab074fabb">QTrkSettings::qi_iterations</a></div><div class="ttdeci">int qi_iterations</div><div class="ttdoc">Number of times to run the QI algorithm, sampling around the last found position. ...</div><div class="ttdef"><b>Definition:</b> <a href="qtrk__c__api_8h_source.html#l00140">qtrk_c_api.h:140</a></div></div>
<div class="ttc" id="struct_q_trk_settings_html_aceebf67ba9ecc215d49c6b2739afae3d"><div class="ttname"><a href="struct_q_trk_settings.html#aceebf67ba9ecc215d49c6b2739afae3d">QTrkSettings::qi_angstep_factor</a></div><div class="ttdeci">float qi_angstep_factor</div><div class="ttdoc">Factor to reduce angular steps on lower iterations. Default 1.0 (no effect). </div><div class="ttdef"><b>Definition:</b> <a href="qtrk__c__api_8h_source.html#l00157">qtrk_c_api.h:157</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4d2c72e4f110d37299c01da8480671f4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4d2c72e4f110d37299c01da8480671f4">&sect;&nbsp;</a></span>Init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void QI::Init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_q_trk_computed_config.html">QTrkComputedConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>cfg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>batchSize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize this QI instance. </p>
<p>Copy relevant settings to local datastructures.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">cfg</td><td>The configuration used for the algorithm. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">batchSize</td><td>The calculation batch size. See <a class="el" href="class_q_i.html#aa7bd10a94c9128943ff9f1775614f704">batchSize</a>. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_q_i__impl_8h_source.html#l00387">387</a> of file <a class="el" href="_q_i__impl_8h_source.html">QI_impl.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;{</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <a class="code" href="struct_q_i_params.html">QIParams</a>&amp; qi = <a class="code" href="class_q_i.html#af69f420666212bcf5f10a5cf03cd161a">params</a>;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    qi.<a class="code" href="struct_q_i_params.html#a1c058b65cd15ff4ab3801551309f9647">maxAngularSteps</a> = cfg.<a class="code" href="struct_q_trk_computed_config.html#a1ba87257b24e5b7e427aa92dd4114792">qi_angstepspq</a>;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    qi.<a class="code" href="struct_q_i_params.html#a233d13629ccc9d8c2c500286b13eeb97">iterations</a> = cfg.<a class="code" href="struct_q_trk_settings.html#a12105babb328a9a7ec90f0eab074fabb">qi_iterations</a>;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    qi.<a class="code" href="struct_q_i_params.html#a59a4abd887cfec3392bb5ecd6891d7d6">maxRadius</a> = cfg.<a class="code" href="struct_q_trk_computed_config.html#a9784dbeb638bde1f3204f9ca5af720c6">qi_maxradius</a>;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    qi.<a class="code" href="struct_q_i_params.html#a4c3b954348ae3ee381eab69122983515">minRadius</a> = cfg.<a class="code" href="struct_q_trk_settings.html#a7b5f3e61b4dcab6330c56e7bcd96e82d">qi_minradius</a>;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    qi.<a class="code" href="struct_q_i_params.html#a19b7d550113364de4e4f11e2c9cfea0e">radialSteps</a> = cfg.<a class="code" href="struct_q_trk_computed_config.html#ab1a11e7a567a3267c57f77626c6c9c93">qi_radialsteps</a>;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    cudaDeviceProp prop;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    cudaGetDeviceProperties(&amp;prop, 0);</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <a class="code" href="class_q_i.html#afd1c6359668f2de142a18caf2a0e76e0">numThreads</a> = prop.warpSize;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    this-&gt;<a class="code" href="class_q_i.html#aa7bd10a94c9128943ff9f1775614f704">batchSize</a> = <a class="code" href="class_q_i.html#aa7bd10a94c9128943ff9f1775614f704">batchSize</a>;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;}</div><div class="ttc" id="struct_q_i_params_html_a233d13629ccc9d8c2c500286b13eeb97"><div class="ttname"><a href="struct_q_i_params.html#a233d13629ccc9d8c2c500286b13eeb97">QIParams::iterations</a></div><div class="ttdeci">int iterations</div><div class="ttdef"><b>Definition:</b> <a href="_q_i_8h_source.html#l00011">QI.h:11</a></div></div>
<div class="ttc" id="struct_q_i_params_html_a1c058b65cd15ff4ab3801551309f9647"><div class="ttname"><a href="struct_q_i_params.html#a1c058b65cd15ff4ab3801551309f9647">QIParams::maxAngularSteps</a></div><div class="ttdeci">int maxAngularSteps</div><div class="ttdoc">Maximum amount of angular steps. Used to enable usage of QTrkSettings::qi_angstep_factor. </div><div class="ttdef"><b>Definition:</b> <a href="_q_i_8h_source.html#l00012">QI.h:12</a></div></div>
<div class="ttc" id="struct_q_trk_settings_html_a7b5f3e61b4dcab6330c56e7bcd96e82d"><div class="ttname"><a href="struct_q_trk_settings.html#a7b5f3e61b4dcab6330c56e7bcd96e82d">QTrkSettings::qi_minradius</a></div><div class="ttdeci">float qi_minradius</div><div class="ttdoc">Distance in pixels from the bead center from which to start sampling profiles. Default 1...</div><div class="ttdef"><b>Definition:</b> <a href="qtrk__c__api_8h_source.html#l00141">qtrk_c_api.h:141</a></div></div>
<div class="ttc" id="struct_q_i_params_html_a59a4abd887cfec3392bb5ecd6891d7d6"><div class="ttname"><a href="struct_q_i_params.html#a59a4abd887cfec3392bb5ecd6891d7d6">QIParams::maxRadius</a></div><div class="ttdeci">float maxRadius</div><div class="ttdef"><b>Definition:</b> <a href="_q_i_8h_source.html#l00009">QI.h:9</a></div></div>
<div class="ttc" id="class_q_i_html_af69f420666212bcf5f10a5cf03cd161a"><div class="ttname"><a href="class_q_i.html#af69f420666212bcf5f10a5cf03cd161a">QI::params</a></div><div class="ttdeci">QIParams params</div><div class="ttdoc">Structure with settings relevant to quadrant interpolation. </div><div class="ttdef"><b>Definition:</b> <a href="_q_i_8h_source.html#l00142">QI.h:142</a></div></div>
<div class="ttc" id="struct_q_i_params_html_a19b7d550113364de4e4f11e2c9cfea0e"><div class="ttname"><a href="struct_q_i_params.html#a19b7d550113364de4e4f11e2c9cfea0e">QIParams::radialSteps</a></div><div class="ttdeci">int radialSteps</div><div class="ttdef"><b>Definition:</b> <a href="_q_i_8h_source.html#l00010">QI.h:10</a></div></div>
<div class="ttc" id="struct_q_i_params_html"><div class="ttname"><a href="struct_q_i_params.html">QIParams</a></div><div class="ttdoc">Structure to hold QI settings. See QTrkComputedConfig for more info on most settings. </div><div class="ttdef"><b>Definition:</b> <a href="_q_i_8h_source.html#l00007">QI.h:7</a></div></div>
<div class="ttc" id="struct_q_trk_computed_config_html_a9784dbeb638bde1f3204f9ca5af720c6"><div class="ttname"><a href="struct_q_trk_computed_config.html#a9784dbeb638bde1f3204f9ca5af720c6">QTrkComputedConfig::qi_maxradius</a></div><div class="ttdeci">float qi_maxradius</div><div class="ttdoc">Max radius in pixels of the sampling circle. </div><div class="ttdef"><b>Definition:</b> <a href="qtrk__c__api_8h_source.html#l00204">qtrk_c_api.h:204</a></div></div>
<div class="ttc" id="class_q_i_html_aa7bd10a94c9128943ff9f1775614f704"><div class="ttname"><a href="class_q_i.html#aa7bd10a94c9128943ff9f1775614f704">QI::batchSize</a></div><div class="ttdeci">int batchSize</div><div class="ttdoc">See QueuedCUDATracker::batchSize. Local copy. </div><div class="ttdef"><b>Definition:</b> <a href="_q_i_8h_source.html#l00149">QI.h:149</a></div></div>
<div class="ttc" id="struct_q_trk_computed_config_html_ab1a11e7a567a3267c57f77626c6c9c93"><div class="ttname"><a href="struct_q_trk_computed_config.html#ab1a11e7a567a3267c57f77626c6c9c93">QTrkComputedConfig::qi_radialsteps</a></div><div class="ttdeci">int qi_radialsteps</div><div class="ttdoc">Number of radial steps to sample on. </div><div class="ttdef"><b>Definition:</b> <a href="qtrk__c__api_8h_source.html#l00202">qtrk_c_api.h:202</a></div></div>
<div class="ttc" id="struct_q_trk_computed_config_html_a1ba87257b24e5b7e427aa92dd4114792"><div class="ttname"><a href="struct_q_trk_computed_config.html#a1ba87257b24e5b7e427aa92dd4114792">QTrkComputedConfig::qi_angstepspq</a></div><div class="ttdeci">int qi_angstepspq</div><div class="ttdoc">Number of angular steps to sample on per quadrant. </div><div class="ttdef"><b>Definition:</b> <a href="qtrk__c__api_8h_source.html#l00203">qtrk_c_api.h:203</a></div></div>
<div class="ttc" id="struct_q_trk_settings_html_a12105babb328a9a7ec90f0eab074fabb"><div class="ttname"><a href="struct_q_trk_settings.html#a12105babb328a9a7ec90f0eab074fabb">QTrkSettings::qi_iterations</a></div><div class="ttdeci">int qi_iterations</div><div class="ttdoc">Number of times to run the QI algorithm, sampling around the last found position. ...</div><div class="ttdef"><b>Definition:</b> <a href="qtrk__c__api_8h_source.html#l00140">qtrk_c_api.h:140</a></div></div>
<div class="ttc" id="struct_q_i_params_html_a4c3b954348ae3ee381eab69122983515"><div class="ttname"><a href="struct_q_i_params.html#a4c3b954348ae3ee381eab69122983515">QIParams::minRadius</a></div><div class="ttdeci">float minRadius</div><div class="ttdef"><b>Definition:</b> <a href="_q_i_8h_source.html#l00008">QI.h:8</a></div></div>
<div class="ttc" id="class_q_i_html_afd1c6359668f2de142a18caf2a0e76e0"><div class="ttname"><a href="class_q_i.html#afd1c6359668f2de142a18caf2a0e76e0">QI::numThreads</a></div><div class="ttdeci">int numThreads</div><div class="ttdoc">See QueuedCUDATracker::numThreads. </div><div class="ttdef"><b>Definition:</b> <a href="_q_i_8h_source.html#l00150">QI.h:150</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a20a5d23a269c8c5cc1dcce1f5d931e20"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a20a5d23a269c8c5cc1dcce1f5d931e20">&sect;&nbsp;</a></span>InitDevice()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void QI::InitDevice </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_q_i_1_1_device_instance.html">DeviceInstance</a> *&#160;</td>
          <td class="paramname"><em>d</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_q_trk_computed_config.html">QTrkComputedConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>cc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Ready a device for QI calculations. </p>
<p>Calculate required parameters and fill a <a class="el" href="struct_q_i_1_1_device_instance.html">DeviceInstance</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">d</td><td>The instance to be initialized. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cc</td><td>The configuration used for the algorithm. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_q_i__impl_8h_source.html#l00344">344</a> of file <a class="el" href="_q_i__impl_8h_source.html">QI_impl.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;{</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    std::vector&lt;float2&gt; qi_radialgrid(cc.<a class="code" href="struct_q_trk_computed_config.html#a1ba87257b24e5b7e427aa92dd4114792">qi_angstepspq</a>);</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;cc.<a class="code" href="struct_q_trk_computed_config.html#a1ba87257b24e5b7e427aa92dd4114792">qi_angstepspq</a>;i++)  {</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        <span class="keywordtype">float</span> ang = 0.5f*3.141593f*(i+0.5f)/(<span class="keywordtype">float</span>)cc.<a class="code" href="struct_q_trk_computed_config.html#a1ba87257b24e5b7e427aa92dd4114792">qi_angstepspq</a>;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        qi_radialgrid[i]=make_float2(cos(ang), sin(ang));</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    }</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    d-&gt;qi_trigtable = qi_radialgrid;</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    std::vector&lt;float&gt; rweights = <a class="code" href="utils_8cpp.html#a8657c1536ca3621943042411f4644e21">ComputeRadialBinWindow</a>(cc.<a class="code" href="struct_q_trk_computed_config.html#ab1a11e7a567a3267c57f77626c6c9c93">qi_radialsteps</a>);</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    d-&gt;d_radialweights = rweights;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <a class="code" href="struct_q_i_params.html">QIParams</a> dp = <a class="code" href="class_q_i.html#af69f420666212bcf5f10a5cf03cd161a">params</a>;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    dp.<a class="code" href="struct_q_i_params.html#a8da3ccdd4b94c119a0d63ff63f28b8e7">cos_sin_table</a> = d-&gt;qi_trigtable.data;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    cudaMalloc(&amp;d-&gt;d_qiparams, <span class="keyword">sizeof</span>(<a class="code" href="struct_q_i_params.html">QIParams</a>));</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    cudaMemcpy(d-&gt;d_qiparams, &amp;dp, <span class="keyword">sizeof</span>(<a class="code" href="struct_q_i_params.html">QIParams</a>), cudaMemcpyHostToDevice);</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;}</div><div class="ttc" id="class_q_i_html_af69f420666212bcf5f10a5cf03cd161a"><div class="ttname"><a href="class_q_i.html#af69f420666212bcf5f10a5cf03cd161a">QI::params</a></div><div class="ttdeci">QIParams params</div><div class="ttdoc">Structure with settings relevant to quadrant interpolation. </div><div class="ttdef"><b>Definition:</b> <a href="_q_i_8h_source.html#l00142">QI.h:142</a></div></div>
<div class="ttc" id="utils_8cpp_html_a8657c1536ca3621943042411f4644e21"><div class="ttname"><a href="utils_8cpp.html#a8657c1536ca3621943042411f4644e21">ComputeRadialBinWindow</a></div><div class="ttdeci">std::vector&lt; float &gt; ComputeRadialBinWindow(int rsteps)</div><div class="ttdoc">Calculate the radial weights for ZLUT profile comparisons. </div><div class="ttdef"><b>Definition:</b> <a href="utils_8cpp_source.html#l00706">utils.cpp:706</a></div></div>
<div class="ttc" id="struct_q_i_params_html"><div class="ttname"><a href="struct_q_i_params.html">QIParams</a></div><div class="ttdoc">Structure to hold QI settings. See QTrkComputedConfig for more info on most settings. </div><div class="ttdef"><b>Definition:</b> <a href="_q_i_8h_source.html#l00007">QI.h:7</a></div></div>
<div class="ttc" id="struct_q_trk_computed_config_html_ab1a11e7a567a3267c57f77626c6c9c93"><div class="ttname"><a href="struct_q_trk_computed_config.html#ab1a11e7a567a3267c57f77626c6c9c93">QTrkComputedConfig::qi_radialsteps</a></div><div class="ttdeci">int qi_radialsteps</div><div class="ttdoc">Number of radial steps to sample on. </div><div class="ttdef"><b>Definition:</b> <a href="qtrk__c__api_8h_source.html#l00202">qtrk_c_api.h:202</a></div></div>
<div class="ttc" id="struct_q_trk_computed_config_html_a1ba87257b24e5b7e427aa92dd4114792"><div class="ttname"><a href="struct_q_trk_computed_config.html#a1ba87257b24e5b7e427aa92dd4114792">QTrkComputedConfig::qi_angstepspq</a></div><div class="ttdeci">int qi_angstepspq</div><div class="ttdoc">Number of angular steps to sample on per quadrant. </div><div class="ttdef"><b>Definition:</b> <a href="qtrk__c__api_8h_source.html#l00203">qtrk_c_api.h:203</a></div></div>
<div class="ttc" id="struct_q_i_params_html_a8da3ccdd4b94c119a0d63ff63f28b8e7"><div class="ttname"><a href="struct_q_i_params.html#a8da3ccdd4b94c119a0d63ff63f28b8e7">QIParams::cos_sin_table</a></div><div class="ttdeci">float2 * cos_sin_table</div><div class="ttdoc">Reference to QI::DeviceInstance::qi_trigtable for use in kernels. Radial sampling points...</div><div class="ttdef"><b>Definition:</b> <a href="_q_i_8h_source.html#l00013">QI.h:13</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae560c53ae31c70ca9a1d6a0a745c75ee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae560c53ae31c70ca9a1d6a0a745c75ee">&sect;&nbsp;</a></span>InitStream()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void QI::InitStream </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_q_i_1_1_stream_instance.html">StreamInstance</a> *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_q_trk_computed_config.html">QTrkComputedConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>cc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cudaStream_t&#160;</td>
          <td class="paramname"><em>stream</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>batchSize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Ready a stream for QI calculations. </p>
<p>Calculate required parameters and fill a <a class="el" href="struct_q_i_1_1_stream_instance.html">StreamInstance</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">s</td><td>The instance to be initialized. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cc</td><td>The configuration used for the algorithm. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">stream</td><td>The normal CUDA stream this QI Stream will relate to. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">batchSize</td><td>The calculation batch size. See <a class="el" href="class_q_i.html#aa7bd10a94c9128943ff9f1775614f704">batchSize</a>. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_q_i__impl_8h_source.html#l00363">363</a> of file <a class="el" href="_q_i__impl_8h_source.html">QI_impl.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;{</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="keywordtype">int</span> fftlen = cc.<a class="code" href="struct_q_trk_computed_config.html#ab1a11e7a567a3267c57f77626c6c9c93">qi_radialsteps</a>*2;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    s-&gt;stream = stream;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    s-&gt;d_quadrants.init(fftlen*<a class="code" href="class_q_i.html#aa7bd10a94c9128943ff9f1775614f704">batchSize</a>*2); <span class="comment">// 4 quadrants * radialSteps * batchSize</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    s-&gt;d_QIprofiles.init(batchSize*2*fftlen); <span class="comment">// (2 axis) * (2 radialsteps) = 4 * nr = 2 * fftlen</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    s-&gt;d_QIprofiles_reverse.init(batchSize*2*fftlen);</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    s-&gt;d_shiftbuffer.init(fftlen * batchSize);</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <span class="comment">// 2* batchSize, since X &amp; Y both need an FFT transform</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <span class="comment">// cufftPlanMany and 1d with batch argument are equivalent in memory usage and speed</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <span class="comment">// Using Many because the batch argument for 1d is strictly speaking deprecated (see cufft.h)</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    cufftResult_t r = cufftPlanMany(&amp;s-&gt;fftPlan, 1, &amp;fftlen, 0, 1, fftlen, 0, 1, fftlen, CUFFT_C2C, batchSize*2);</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <span class="comment">//cufftResult_t r = cufftPlan1d(&amp;s-&gt;fftPlan, fftlen, CUFFT_C2C, batchSize*2);</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="keywordflow">if</span>(r != CUFFT_SUCCESS) {</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        <span class="keywordflow">throw</span> std::runtime_error( <a class="code" href="utils_8cpp.html#aba26a6b64035ef7962a63b760dd9013e">SPrintf</a>(<span class="stringliteral">&quot;CUFFT plan creation failed. FFT len: %d. Batchsize: %d\n&quot;</span>, fftlen, batchSize*2));</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    }</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <a class="code" href="gpu__utils_8h.html#ae6b059a7637782d61577e695c9d6303e">CheckCUDAError</a>(cufftSetCompatibilityMode(s-&gt;fftPlan, CUFFT_COMPATIBILITY_NATIVE));</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <a class="code" href="gpu__utils_8h.html#ae6b059a7637782d61577e695c9d6303e">CheckCUDAError</a>(cufftSetStream(s-&gt;fftPlan, stream));</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    this-&gt;<a class="code" href="class_q_i.html#a9959b6d60486da504fca5c3c86fb2fdd">qi_FFT_length</a> = fftlen;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;}</div><div class="ttc" id="class_q_i_html_a9959b6d60486da504fca5c3c86fb2fdd"><div class="ttname"><a href="class_q_i.html#a9959b6d60486da504fca5c3c86fb2fdd">QI::qi_FFT_length</a></div><div class="ttdeci">int qi_FFT_length</div><div class="ttdoc">Parameter for length required for arrays going into FFT. 2 * radial steps. </div><div class="ttdef"><b>Definition:</b> <a href="_q_i_8h_source.html#l00148">QI.h:148</a></div></div>
<div class="ttc" id="gpu__utils_8h_html_ae6b059a7637782d61577e695c9d6303e"><div class="ttname"><a href="gpu__utils_8h.html#ae6b059a7637782d61577e695c9d6303e">CheckCUDAError</a></div><div class="ttdeci">void CheckCUDAError(cufftResult_t err)</div><div class="ttdef"><b>Definition:</b> <a href="gpu__utils_8h_source.html#l00036">gpu_utils.h:36</a></div></div>
<div class="ttc" id="class_q_i_html_aa7bd10a94c9128943ff9f1775614f704"><div class="ttname"><a href="class_q_i.html#aa7bd10a94c9128943ff9f1775614f704">QI::batchSize</a></div><div class="ttdeci">int batchSize</div><div class="ttdoc">See QueuedCUDATracker::batchSize. Local copy. </div><div class="ttdef"><b>Definition:</b> <a href="_q_i_8h_source.html#l00149">QI.h:149</a></div></div>
<div class="ttc" id="struct_q_trk_computed_config_html_ab1a11e7a567a3267c57f77626c6c9c93"><div class="ttname"><a href="struct_q_trk_computed_config.html#ab1a11e7a567a3267c57f77626c6c9c93">QTrkComputedConfig::qi_radialsteps</a></div><div class="ttdeci">int qi_radialsteps</div><div class="ttdoc">Number of radial steps to sample on. </div><div class="ttdef"><b>Definition:</b> <a href="qtrk__c__api_8h_source.html#l00202">qtrk_c_api.h:202</a></div></div>
<div class="ttc" id="utils_8cpp_html_aba26a6b64035ef7962a63b760dd9013e"><div class="ttname"><a href="utils_8cpp.html#aba26a6b64035ef7962a63b760dd9013e">SPrintf</a></div><div class="ttdeci">std::string SPrintf(const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="utils_8cpp_source.html#l00132">utils.cpp:132</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7fef057a722e3c85152f947c7a7dd42a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7fef057a722e3c85152f947c7a7dd42a">&sect;&nbsp;</a></span>Iterate()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename TImageSampler &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void QI::Iterate </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_base_kernel_params.html">BaseKernelParams</a> &amp;&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classdevice__vec.html">device_vec</a>&lt; float3 &gt; *&#160;</td>
          <td class="paramname"><em>initial</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classdevice__vec.html">device_vec</a>&lt; float3 &gt; *&#160;</td>
          <td class="paramname"><em>output</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_q_i_1_1_stream_instance.html">StreamInstance</a> *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_q_i_1_1_device_instance.html">DeviceInstance</a> *&#160;</td>
          <td class="paramname"><em>d</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>angularSteps</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Perform one QI iteration. </p>
<p>This is where the actual algorithm is executed. See <a class="el" href="citelist.html#CITEREF_loen:QI">[3]</a> for details.</p>
<p>The kernels are called in the following order:</p><ul>
<li><a class="el" href="group__kernels.html#gaa7f87ffff59ddad03f962165afc5ee08">QI_ComputeQuadrants</a> - Calculate the 4 quadrant profiles</li>
<li><a class="el" href="group__kernels.html#ga0a68cdd1dd0c10476711ae6d4316fb40">QI_QuadrantsToProfiles</a> - Convert the quadrant profiles into the concatenated and their respective reverse profiles</li>
<li>Forward FFT (<a href="http://docs.nvidia.com/cuda/cufft/">CUFFT</a>) - Calculate the fourier transforms of the profiles and reverse profiles</li>
<li><a class="el" href="group__kernels.html#gaf620f6888bd27603c02cbbcc6cb77cce">QI_MultiplyWithConjugate</a> - Multiply the transforms to calculate their autocorrelation</li>
<li>Reverse FFT (<a href="http://docs.nvidia.com/cuda/cufft/">CUFFT</a>) - Transform the multiplied transforms back to the time-domain autocorrelation</li>
<li><a class="el" href="group__kernels.html#ga095edb116bff714a009b7cf60b52cb3b">QI_OffsetPositions</a> - Calculate and apply the X and Y shifts from the autocorrelations</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">p</td><td>KernelParamaters to use. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">initial</td><td>The initial positions to use as sampling centers. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">output</td><td>Vector with the resulting positions. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">s</td><td>The stream to execute. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">d</td><td>The device on which to execute. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">angularSteps</td><td>The number of angular steps to use. </td></tr>
  </table>
  </dd>
</dl>
<p>Huge speedup achieved by calculating each quadrant's radial bin in a seperate thread. This leads to more, smaller kernels running concurrently so more memory latency hiding can be achieved through higher occupancy. For a visual display of this, try running the NVidia Visual Profiler with both versions of quadrant profile kernels. </p>

<p>Definition at line <a class="el" href="_q_i__impl_8h_source.html#l00280">280</a> of file <a class="el" href="_q_i__impl_8h_source.html">QI_impl.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;{</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="comment">/* Old method of calculating quadrant profiles.</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment">    QIParams dp = params;</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="comment">    dp.cos_sin_table = d-&gt;qi_trigtable.data;</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="comment">    QI_ComputeProfile &lt;TImageSampler&gt; &lt;&lt;&lt; blocks(p.njobs), threads(), 0, s-&gt;stream &gt;&gt;&gt; (p, initial-&gt;data, </span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="comment">        s-&gt;d_quadrants.data, s-&gt;d_QIprofiles.data, s-&gt;d_QIprofiles_reverse.data, dp, d-&gt;d_radialweights.data, angularSteps);</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="comment">    // DbgOutputVectorToFile(&quot;D:\\TestImages\\gpu_qi_prof_old.csv&quot;, s-&gt;d_quadrants, true);</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    dim3 qdrThreads(16, 8, 4);</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    dim3 qdrDim( (p.<a class="code" href="struct_base_kernel_params.html#aec40d44810d0e0a6640c66038af1fbf2">njobs</a> + qdrThreads.x - 1) / qdrThreads.x, (<a class="code" href="class_q_i.html#af69f420666212bcf5f10a5cf03cd161a">params</a>.<a class="code" href="struct_q_i_params.html#a19b7d550113364de4e4f11e2c9cfea0e">radialSteps</a> + qdrThreads.y - 1) / qdrThreads.y);</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    QI_ComputeQuadrants&lt;TImageSampler&gt; &lt;&lt;&lt; qdrDim , qdrThreads, 0, s-&gt;stream &gt;&gt;&gt; </div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        (p, initial-&gt;<a class="code" href="classdevice__vec.html#a908e53910a02968513832c242790caa0">data</a>, s-&gt;d_quadrants.data, d-&gt;d_qiparams, angularSteps);</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        </div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <a class="code" href="group__kernels.html#ga0a68cdd1dd0c10476711ae6d4316fb40">QI_QuadrantsToProfiles</a> &lt;&lt;&lt; <a class="code" href="class_q_i.html#aae8ddb96f755ee2cc38d9fb36e742dde">blocks</a>(p.<a class="code" href="struct_base_kernel_params.html#aec40d44810d0e0a6640c66038af1fbf2">njobs</a>), <a class="code" href="class_q_i.html#aef6a690a8934bcc7ced5332518b04660">threads</a>(), 0, s-&gt;stream &gt;&gt;&gt; </div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        (p, s-&gt;d_quadrants.data, s-&gt;d_QIprofiles.data, s-&gt;d_QIprofiles_reverse.data, d-&gt;d_radialweights.data, d-&gt;d_qiparams);</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="comment">// DbgOutputVectorToFile(&quot;D:\\TestImages\\gpu_qi_prof_new.csv&quot;, s-&gt;d_quadrants, true);</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="preprocessor">#ifdef QI_DEBUG</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <a class="code" href="gpu__utils_8h.html#a90bb5228a452340dd6a505cfb4db25c7">DbgCopyResult</a>(s-&gt;d_QIprofiles, <a class="code" href="test_8cu.html#a0f78dfbff0fc38f749d5a83cf7293b89">cmp_gpu_qi_prof</a>);</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    cufftComplex* prof = (cufftComplex*)s-&gt;d_QIprofiles.data;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    cufftComplex* revprof = (cufftComplex*)s-&gt;d_QIprofiles_reverse.data;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <a class="code" href="gpu__utils_8h.html#ae6b059a7637782d61577e695c9d6303e">CheckCUDAError</a>(cufftExecC2C(s-&gt;fftPlan, prof, prof, CUFFT_FORWARD));</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <a class="code" href="gpu__utils_8h.html#ae6b059a7637782d61577e695c9d6303e">CheckCUDAError</a>(cufftExecC2C(s-&gt;fftPlan, revprof, revprof, CUFFT_FORWARD));</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="keywordtype">int</span> nval = <a class="code" href="class_q_i.html#a9959b6d60486da504fca5c3c86fb2fdd">qi_FFT_length</a> * 2 * <a class="code" href="class_q_i.html#aa7bd10a94c9128943ff9f1775614f704">batchSize</a>;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <span class="keywordtype">int</span> nthread = 256;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <a class="code" href="group__kernels.html#gaf620f6888bd27603c02cbbcc6cb77cce">QI_MultiplyWithConjugate</a>&lt;&lt;&lt; dim3( (nval + nthread - 1)/nthread ), dim3(nthread), 0, s-&gt;stream &gt;&gt;&gt;(nval, prof, revprof);</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="comment">/* </span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment">    Experiment to see the effect of different block sizes.</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment">    Seems that if the whole parameter space is covered, block sizes don&#39;t matter for execution speed.</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment">    dim3 threadsDim = dim3(16, 16);</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="comment">    int numBlocks = nval / (threadsDim.x * threadsDim.y);</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment">    dim3 blocksDim = dim3( sqrt((double)numBlocks)+1, sqrt((double)numBlocks)+1 );</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="comment">        </span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment">    if(nval &gt; threadsDim.x * threadsDim.y * blocksDim.x * blocksDim.y){</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment">        printf(&quot;\nNot whole space covered: nval &gt; total threads\n&quot;);</span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="comment">        printf(&quot;nval: %d, nthread: %d, block (%d,%d), threads (%d,%d)\n&quot;, nval, nthread, blocksDim.x, blocksDim.y, threadsDim.x, threadsDim.y);</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="comment">    }</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment">    QI_MultiplyWithConjugate&lt;&lt;&lt; blocksDim, threadsDim, 0, s-&gt;stream &gt;&gt;&gt; (nval, prof, revprof);</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    </div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <a class="code" href="gpu__utils_8h.html#ae6b059a7637782d61577e695c9d6303e">CheckCUDAError</a>(cufftExecC2C(s-&gt;fftPlan, prof, prof, CUFFT_INVERSE));</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="preprocessor">#ifdef QI_DEBUG</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <a class="code" href="gpu__utils_8h.html#a90bb5228a452340dd6a505cfb4db25c7">DbgCopyResult</a>(s-&gt;d_QIprofiles, <a class="code" href="test_8cu.html#a968a1f45bfd391f01eaee72d1ba61237">cmp_gpu_qi_fft_out</a>);</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    float2* d_offsets=0;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="keywordtype">float</span> pixelsPerProfLen = (<a class="code" href="class_q_i.html#af69f420666212bcf5f10a5cf03cd161a">params</a>.<a class="code" href="struct_q_i_params.html#a59a4abd887cfec3392bb5ecd6891d7d6">maxRadius</a>-<a class="code" href="class_q_i.html#af69f420666212bcf5f10a5cf03cd161a">params</a>.<a class="code" href="struct_q_i_params.html#a4c3b954348ae3ee381eab69122983515">minRadius</a>)/<a class="code" href="class_q_i.html#af69f420666212bcf5f10a5cf03cd161a">params</a>.<a class="code" href="struct_q_i_params.html#a19b7d550113364de4e4f11e2c9cfea0e">radialSteps</a>;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    dim3 nBlocks=<a class="code" href="class_q_i.html#aae8ddb96f755ee2cc38d9fb36e742dde">blocks</a>(p.<a class="code" href="struct_base_kernel_params.html#aec40d44810d0e0a6640c66038af1fbf2">njobs</a>), nThreads=<a class="code" href="class_q_i.html#aef6a690a8934bcc7ced5332518b04660">threads</a>();</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <a class="code" href="group__kernels.html#ga095edb116bff714a009b7cf60b52cb3b">QI_OffsetPositions</a>&lt;&lt;&lt;nBlocks, nThreads, 0, s-&gt;stream&gt;&gt;&gt;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        (p.<a class="code" href="struct_base_kernel_params.html#aec40d44810d0e0a6640c66038af1fbf2">njobs</a>, initial-&gt;<a class="code" href="classdevice__vec.html#a908e53910a02968513832c242790caa0">data</a>, newpos-&gt;data, prof, <a class="code" href="class_q_i.html#a9959b6d60486da504fca5c3c86fb2fdd">qi_FFT_length</a>, d_offsets, pixelsPerProfLen, s-&gt;d_shiftbuffer.data); </div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;}</div><div class="ttc" id="test_8cu_html_a968a1f45bfd391f01eaee72d1ba61237"><div class="ttname"><a href="test_8cu.html#a968a1f45bfd391f01eaee72d1ba61237">cmp_gpu_qi_fft_out</a></div><div class="ttdeci">std::vector&lt; std::complex&lt; float &gt; &gt; cmp_gpu_qi_fft_out</div><div class="ttdef"><b>Definition:</b> <a href="test_8cu_source.html#l00672">test.cu:672</a></div></div>
<div class="ttc" id="class_q_i_html_a9959b6d60486da504fca5c3c86fb2fdd"><div class="ttname"><a href="class_q_i.html#a9959b6d60486da504fca5c3c86fb2fdd">QI::qi_FFT_length</a></div><div class="ttdeci">int qi_FFT_length</div><div class="ttdoc">Parameter for length required for arrays going into FFT. 2 * radial steps. </div><div class="ttdef"><b>Definition:</b> <a href="_q_i_8h_source.html#l00148">QI.h:148</a></div></div>
<div class="ttc" id="struct_q_i_params_html_a59a4abd887cfec3392bb5ecd6891d7d6"><div class="ttname"><a href="struct_q_i_params.html#a59a4abd887cfec3392bb5ecd6891d7d6">QIParams::maxRadius</a></div><div class="ttdeci">float maxRadius</div><div class="ttdef"><b>Definition:</b> <a href="_q_i_8h_source.html#l00009">QI.h:9</a></div></div>
<div class="ttc" id="group__kernels_html_ga0a68cdd1dd0c10476711ae6d4316fb40"><div class="ttname"><a href="group__kernels.html#ga0a68cdd1dd0c10476711ae6d4316fb40">QI_QuadrantsToProfiles</a></div><div class="ttdeci">__global__ void QI_QuadrantsToProfiles(BaseKernelParams kp, float *quadrants, float2 *profiles, float2 *reverseProfiles, float *d_radialweights, const QIParams *params)</div><div class="ttdef"><b>Definition:</b> <a href="_q_i__impl_8h_source.html#l00215">QI_impl.h:215</a></div></div>
<div class="ttc" id="class_q_i_html_af69f420666212bcf5f10a5cf03cd161a"><div class="ttname"><a href="class_q_i.html#af69f420666212bcf5f10a5cf03cd161a">QI::params</a></div><div class="ttdeci">QIParams params</div><div class="ttdoc">Structure with settings relevant to quadrant interpolation. </div><div class="ttdef"><b>Definition:</b> <a href="_q_i_8h_source.html#l00142">QI.h:142</a></div></div>
<div class="ttc" id="struct_q_i_params_html_a19b7d550113364de4e4f11e2c9cfea0e"><div class="ttname"><a href="struct_q_i_params.html#a19b7d550113364de4e4f11e2c9cfea0e">QIParams::radialSteps</a></div><div class="ttdeci">int radialSteps</div><div class="ttdef"><b>Definition:</b> <a href="_q_i_8h_source.html#l00010">QI.h:10</a></div></div>
<div class="ttc" id="gpu__utils_8h_html_ae6b059a7637782d61577e695c9d6303e"><div class="ttname"><a href="gpu__utils_8h.html#ae6b059a7637782d61577e695c9d6303e">CheckCUDAError</a></div><div class="ttdeci">void CheckCUDAError(cufftResult_t err)</div><div class="ttdef"><b>Definition:</b> <a href="gpu__utils_8h_source.html#l00036">gpu_utils.h:36</a></div></div>
<div class="ttc" id="classdevice__vec_html_a908e53910a02968513832c242790caa0"><div class="ttname"><a href="classdevice__vec.html#a908e53910a02968513832c242790caa0">device_vec::data</a></div><div class="ttdeci">T * data</div><div class="ttdef"><b>Definition:</b> <a href="gpu__utils_8h_source.html#l00156">gpu_utils.h:156</a></div></div>
<div class="ttc" id="group__kernels_html_gaf620f6888bd27603c02cbbcc6cb77cce"><div class="ttname"><a href="group__kernels.html#gaf620f6888bd27603c02cbbcc6cb77cce">QI_MultiplyWithConjugate</a></div><div class="ttdeci">__global__ void QI_MultiplyWithConjugate(int n, cufftComplex *a, cufftComplex *b)</div><div class="ttdef"><b>Definition:</b> <a href="_q_i__impl_8h_source.html#l00102">QI_impl.h:102</a></div></div>
<div class="ttc" id="class_q_i_html_aef6a690a8934bcc7ced5332518b04660"><div class="ttname"><a href="class_q_i.html#aef6a690a8934bcc7ced5332518b04660">QI::threads</a></div><div class="ttdeci">dim3 threads()</div><div class="ttdoc">Same function as QueuedCUDATracker::threads. </div><div class="ttdef"><b>Definition:</b> <a href="_q_i_8h_source.html#l00155">QI.h:155</a></div></div>
<div class="ttc" id="group__kernels_html_ga095edb116bff714a009b7cf60b52cb3b"><div class="ttname"><a href="group__kernels.html#ga095edb116bff714a009b7cf60b52cb3b">QI_OffsetPositions</a></div><div class="ttdeci">__global__ void QI_OffsetPositions(int njobs, float3 *current, float3 *dst, cufftComplex *autoconv, int fftLength, float2 *offsets, float pixelsPerProfLen, float *shiftbuf)</div><div class="ttdef"><b>Definition:</b> <a href="_q_i__impl_8h_source.html#l00130">QI_impl.h:130</a></div></div>
<div class="ttc" id="class_q_i_html_aa7bd10a94c9128943ff9f1775614f704"><div class="ttname"><a href="class_q_i.html#aa7bd10a94c9128943ff9f1775614f704">QI::batchSize</a></div><div class="ttdeci">int batchSize</div><div class="ttdoc">See QueuedCUDATracker::batchSize. Local copy. </div><div class="ttdef"><b>Definition:</b> <a href="_q_i_8h_source.html#l00149">QI.h:149</a></div></div>
<div class="ttc" id="gpu__utils_8h_html_a90bb5228a452340dd6a505cfb4db25c7"><div class="ttname"><a href="gpu__utils_8h.html#a90bb5228a452340dd6a505cfb4db25c7">DbgCopyResult</a></div><div class="ttdeci">void DbgCopyResult(device_vec&lt; float2 &gt; src, std::vector&lt; std::complex&lt; float &gt; &gt; &amp;dst)</div><div class="ttdef"><b>Definition:</b> <a href="gpu__utils_8h_source.html#l00268">gpu_utils.h:268</a></div></div>
<div class="ttc" id="test_8cu_html_a0f78dfbff0fc38f749d5a83cf7293b89"><div class="ttname"><a href="test_8cu.html#a0f78dfbff0fc38f749d5a83cf7293b89">cmp_gpu_qi_prof</a></div><div class="ttdeci">std::vector&lt; float &gt; cmp_gpu_qi_prof</div><div class="ttdef"><b>Definition:</b> <a href="test_8cu_source.html#l00669">test.cu:669</a></div></div>
<div class="ttc" id="struct_base_kernel_params_html_aec40d44810d0e0a6640c66038af1fbf2"><div class="ttname"><a href="struct_base_kernel_params.html#aec40d44810d0e0a6640c66038af1fbf2">BaseKernelParams::njobs</a></div><div class="ttdeci">int njobs</div><div class="ttdoc">Number of jobs in the batch. </div><div class="ttdef"><b>Definition:</b> <a href="_queued_c_u_d_a_tracker_8h_source.html#l00054">QueuedCUDATracker.h:54</a></div></div>
<div class="ttc" id="struct_q_i_params_html_a4c3b954348ae3ee381eab69122983515"><div class="ttname"><a href="struct_q_i_params.html#a4c3b954348ae3ee381eab69122983515">QIParams::minRadius</a></div><div class="ttdeci">float minRadius</div><div class="ttdef"><b>Definition:</b> <a href="_q_i_8h_source.html#l00008">QI.h:8</a></div></div>
<div class="ttc" id="class_q_i_html_aae8ddb96f755ee2cc38d9fb36e742dde"><div class="ttname"><a href="class_q_i.html#aae8ddb96f755ee2cc38d9fb36e742dde">QI::blocks</a></div><div class="ttdeci">dim3 blocks(int njobs)</div><div class="ttdoc">Same function as QueuedCUDATracker::blocks. </div><div class="ttdef"><b>Definition:</b> <a href="_q_i_8h_source.html#l00153">QI.h:153</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aef6a690a8934bcc7ced5332518b04660"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aef6a690a8934bcc7ced5332518b04660">&sect;&nbsp;</a></span>threads()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">dim3 QI::threads </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Same function as <a class="el" href="class_queued_c_u_d_a_tracker.html#ae88c5554dba8227967f4a600ff7fab84">QueuedCUDATracker::threads</a>. </p>

<p>Definition at line <a class="el" href="_q_i_8h_source.html#l00155">155</a> of file <a class="el" href="_q_i_8h_source.html">QI.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;{ <span class="keywordflow">return</span> dim3(<a class="code" href="class_q_i.html#afd1c6359668f2de142a18caf2a0e76e0">numThreads</a>); }</div><div class="ttc" id="class_q_i_html_afd1c6359668f2de142a18caf2a0e76e0"><div class="ttname"><a href="class_q_i.html#afd1c6359668f2de142a18caf2a0e76e0">QI::numThreads</a></div><div class="ttdeci">int numThreads</div><div class="ttdoc">See QueuedCUDATracker::numThreads. </div><div class="ttdef"><b>Definition:</b> <a href="_q_i_8h_source.html#l00150">QI.h:150</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="aa7bd10a94c9128943ff9f1775614f704"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa7bd10a94c9128943ff9f1775614f704">&sect;&nbsp;</a></span>batchSize</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int QI::batchSize</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>See <a class="el" href="class_queued_c_u_d_a_tracker.html#a19a027c0cc319821c25de1cb23e14a17">QueuedCUDATracker::batchSize</a>. Local copy. </p>

<p>Definition at line <a class="el" href="_q_i_8h_source.html#l00149">149</a> of file <a class="el" href="_q_i_8h_source.html">QI.h</a>.</p>

</div>
</div>
<a id="afd1c6359668f2de142a18caf2a0e76e0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afd1c6359668f2de142a18caf2a0e76e0">&sect;&nbsp;</a></span>numThreads</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int QI::numThreads</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>See <a class="el" href="class_queued_c_u_d_a_tracker.html#a1bbaf466f197bd745411786578b743bc">QueuedCUDATracker::numThreads</a>. </p>

<p>Definition at line <a class="el" href="_q_i_8h_source.html#l00150">150</a> of file <a class="el" href="_q_i_8h_source.html">QI.h</a>.</p>

</div>
</div>
<a id="af69f420666212bcf5f10a5cf03cd161a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af69f420666212bcf5f10a5cf03cd161a">&sect;&nbsp;</a></span>params</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct_q_i_params.html">QIParams</a> QI::params</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Structure with settings relevant to quadrant interpolation. </p>

<p>Definition at line <a class="el" href="_q_i_8h_source.html#l00142">142</a> of file <a class="el" href="_q_i_8h_source.html">QI.h</a>.</p>

</div>
</div>
<a id="a9959b6d60486da504fca5c3c86fb2fdd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9959b6d60486da504fca5c3c86fb2fdd">&sect;&nbsp;</a></span>qi_FFT_length</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int QI::qi_FFT_length</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Parameter for length required for arrays going into FFT. 2 * radial steps. </p>
<p>Used to be nearest power of two, but since switching to cuFFT, this is not needed for speed optimization anymore. </p>

<p>Definition at line <a class="el" href="_q_i_8h_source.html#l00148">148</a> of file <a class="el" href="_q_i_8h_source.html">QI.h</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>cudatrack/<a class="el" href="_q_i_8h_source.html">QI.h</a></li>
<li>cudatrack/<a class="el" href="_q_i__impl_8h_source.html">QI_impl.h</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.12
</small></address>
</body>
</html>
